{"version":3,"sources":["webpack:///./src/views/resources/PicarticleEdit.vue?bf96","webpack:///./src/views/resources/PicarticleEdit.vue?eb29","webpack:///src/views/resources/PicarticleEdit.vue","webpack:///./src/views/resources/PicarticleEdit.vue?5a71","webpack:///./src/views/resources/PicarticleEdit.vue","webpack:///./src/assets/javascript/mixins_upload.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","staticClass","_v","_s","id","model","value","callback","$$v","$set","expression","_l","item","key","_id","name","uploadUrl","uploadHeaders","picUploadSuccess","beforeUpload","pic","on","handleImageAdded","save","staticRenderFns","props","mixins","mixins_upload","data","title","body","categories","author","JSON","parse","localStorage","getItem","picarticleCate","watch","$route","fetchPicarticleItem","mounted","fetchPicarticleTwo","methods","res","url","components","VueEditor","component","computed","process","uploadSuccess","icon","file","isJPG","type","isLt5M","size","$message","error"],"mappings":"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","file":"js/chunk-062450f2.7d26a5e6.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PicarticleEdit.vue?vue&type=style&index=0&id=1631c421&lang=stylus&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PicarticleEdit.vue?vue&type=style&index=0&id=1631c421&lang=stylus&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"picarticle-edit\"}},[_c('el-card',{staticClass:\"box-card\"},[_c('h1',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.id ? '编辑' : '新建')+\"图文\")]),_c('el-form',{attrs:{\"label-position\":\"right\",\"label-width\":\"100px\"}},[_c('el-form-item',{attrs:{\"label\":\"标题\"}},[_c('el-input',{attrs:{\"placeholder\":\"请输入图文标题\"},model:{value:(_vm.model.title),callback:function ($$v) {_vm.$set(_vm.model, \"title\", $$v)},expression:\"model.title\"}})],1),_c('el-form-item',{attrs:{\"label\":\"所属分类\"}},[_c('el-select',{attrs:{\"multiple\":\"\",\"placeholder\":\"请选择\"},model:{value:(_vm.model.categories),callback:function ($$v) {_vm.$set(_vm.model, \"categories\", $$v)},expression:\"model.categories\"}},_vm._l((_vm.picarticleCate),function(item){return _c('el-option',{key:item._id,attrs:{\"label\":item.name,\"value\":item._id}})}),1)],1),_c('el-form-item',{attrs:{\"label\":\"上传日期\"}},[_c('el-date-picker',{attrs:{\"type\":\"date\",\"format\":\"yyyy 年 MM 月 dd 日\",\"value-format\":\"timestamp\",\"placeholder\":\"选择日期\"},model:{value:(_vm.model.date),callback:function ($$v) {_vm.$set(_vm.model, \"date\", $$v)},expression:\"model.date\"}})],1),_c('el-form-item',{attrs:{\"label\":\"封面\"}},[_c('el-upload',{staticClass:\"avatar-uploader\",attrs:{\"action\":_vm.uploadUrl,\"show-file-list\":false,\"headers\":_vm.uploadHeaders,\"on-success\":_vm.picUploadSuccess,\"before-upload\":_vm.beforeUpload}},[(_vm.model.pic)?_c('img',{staticClass:\"banner\",attrs:{\"src\":_vm.model.pic}}):_c('i',{staticClass:\"el-icon-plus banner-uploader-icon\"})])],1),_c('el-form-item',{attrs:{\"label\":\"详情\"}},[_c('vue-editor',{attrs:{\"useCustomImageHandler\":\"\"},on:{\"image-added\":_vm.handleImageAdded},model:{value:(_vm.model.body),callback:function ($$v) {_vm.$set(_vm.model, \"body\", $$v)},expression:\"model.body\"}})],1)],1),_c('div',{staticClass:\"save\"},[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.save}},[_vm._v(\"保存\")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div id=\"picarticle-edit\">\n    <el-card class=\"box-card\">\n      <h1 class=\"title\">{{ id ? '编辑' : '新建' }}图文</h1>\n      <el-form label-position=\"right\" label-width=\"100px\">\n        <el-form-item label=\"标题\">\n          <el-input v-model=\"model.title\" placeholder=\"请输入图文标题\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"所属分类\">\n          <el-select v-model=\"model.categories\" multiple placeholder=\"请选择\">\n            <el-option\n              v-for=\"item in picarticleCate\"\n              :key=\"item._id\"\n              :label=\"item.name\"\n              :value=\"item._id\"\n            >\n            </el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"上传日期\">\n          <el-date-picker\n            v-model=\"model.date\"\n            type=\"date\"\n            format=\"yyyy 年 MM 月 dd 日\"\n            value-format=\"timestamp\"\n            placeholder=\"选择日期\"\n          >\n          </el-date-picker>\n        </el-form-item>\n        <el-form-item label=\"封面\">\n          <el-upload\n            class=\"avatar-uploader\"\n            :action=\"uploadUrl\"\n            :show-file-list=\"false\"\n            :headers=\"uploadHeaders\"\n            :on-success=\"picUploadSuccess\"\n            :before-upload=\"beforeUpload\"\n          >\n            <img v-if=\"model.pic\" :src=\"model.pic\" class=\"banner\" />\n            <i v-else class=\"el-icon-plus banner-uploader-icon\"></i>\n          </el-upload>\n        </el-form-item>\n        <el-form-item label=\"详情\">\n          <vue-editor v-model=\"model.body\" useCustomImageHandler @image-added=\"handleImageAdded\">\n          </vue-editor>\n        </el-form-item>\n      </el-form>\n      <div class=\"save\">\n        <el-button type=\"primary\" @click=\"save\">保存</el-button>\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport {\n  fetchPicarticleTwo,\n  savePicarticle,\n  updatePicarticle,\n  uploadEditorFile,\n  fetchPicarticleItem,\n} from '@/api/resource'\nimport { VueEditor } from 'vue2-editor'\nimport mixins_upload from '@/assets/javascript/mixins_upload'\nexport default {\n  name: 'picarticleEdit',\n  props: ['id'],\n  mixins: [mixins_upload],\n  data() {\n    return {\n      model: {\n        title: '',\n        body: '',\n        pic: '',\n        categories: [],\n        author: JSON.parse(localStorage.getItem('user'))['name'] || '',\n      },\n      picarticleCate: [],\n    }\n  },\n  watch: {\n    $route() {\n      if (this.id) {\n        this.fetchPicarticleItem()\n      } else {\n        this.model.title = ''\n        this.model.body = ''\n        this.model.categories = []\n        this.model.pic = ''\n        this.model.author = ''\n      }\n    },\n  },\n  mounted() {\n    this.fetchPicarticleTwo()\n    this.id && this.fetchPicarticleItem()\n  },\n  methods: {\n    // 保存文章\n    async save() {\n      const { title, body, categories, author, pic, date } = this.model\n      const id = this.id\n      // 名字不能为空\n      if (!title) {\n        this.$message.error('图文标题不能为空')\n        return\n      }\n      if (!categories.length) {\n        this.$message.error('至少要选择一个分类')\n        return\n      }\n      if (!date) {\n        this.$message.error('上传日期不能为空')\n        return\n      }\n      if (!body) {\n        this.$message.error('图文详情不能为空')\n        return\n      }\n\n      //根据id判断是新建还是编辑\n      let res\n      if (id) {\n        res = await updatePicarticle({ id, title, body, categories, pic, date })\n      } else {\n        res = await savePicarticle({ title, body, author, categories, pic, date })\n      }\n      // 该图文已存在\n      if (res.status === 1) {\n        this.$message.error(res.msg)\n        return\n      }\n      this.$message.success(res.msg)\n      this.$router.push('/resource/picarticleList')\n    },\n    // 获取文章二级分类\n    async fetchPicarticleTwo() {\n      const res = await fetchPicarticleTwo()\n      this.picarticleCate = res.data\n    },\n    // 获取文章详情\n    async fetchPicarticleItem() {\n      const res = await fetchPicarticleItem({ id: this.id })\n      this.model = res.data\n    },\n    // 富文本文件上传\n    async handleImageAdded(file, Editor, cursorLocation, resetUploader) {\n      const formData = new FormData()\n      formData.append('file', file)\n\n      const res = await uploadEditorFile(formData)\n      Editor.insertEmbed(cursorLocation, 'image', res.data.url)\n      resetUploader()\n    },\n    picUploadSuccess(res) {\n      this.model.pic = res.data.url\n    },\n  },\n  components: {\n    VueEditor,\n  },\n}\n</script>\n\n<style lang=\"stylus\" scoped>\n@import '../../assets/stylus/variable.styl';\n\n#picarticle-edit {\n  .box-card {\n    width: 1000px;\n    margin: 0 auto;\n    box-shadow: none;\n\n    .title {\n      margin-bottom: 30px;\n      font-size: $font-s;\n    }\n\n    .el-form-item {\n      margin-bottom: 30px;\n    }\n\n    .save {\n      text-align: right;\n      margin-top: 30px;\n    }\n  }\n}\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PicarticleEdit.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PicarticleEdit.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PicarticleEdit.vue?vue&type=template&id=1631c421&scoped=true&\"\nimport script from \"./PicarticleEdit.vue?vue&type=script&lang=js&\"\nexport * from \"./PicarticleEdit.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PicarticleEdit.vue?vue&type=style&index=0&id=1631c421&lang=stylus&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1631c421\",\n  null\n  \n)\n\nexport default component.exports","export default {\n  computed: {\n    // 文件上传地址\n    uploadUrl() {\n      return process.env.VUE_APP_BASE_API ?\n        process.env.VUE_APP_BASE_API + '/upload/images' : '/admin/upload/images'\n    },\n    // 文件上传时的请求头\n    uploadHeaders() {\n      return { 'Authorization': localStorage.getItem('token') || '' }\n    }\n  },\n  methods: {\n    // 文件上传成功的回调函数\n    uploadSuccess(res) {\n      this.model.icon = res.data.url\n    },\n    // 文件上传之前的回调函数\n    beforeUpload(file) {\n      const isJPG = file.type === 'image/jpeg' || file.type === 'image/png';\n      const isLt5M = file.size / 1024 / 1024 < 5;\n\n      if (!isJPG) {\n        this.$message.error('上传图片只能是 JPG或PNG 格式!');\n      }\n      if (!isLt5M) {\n        this.$message.error('上传图片大小不能超过 5MB!');\n      }\n      return isJPG && isLt5M;\n    }\n  }\n}"],"sourceRoot":""}